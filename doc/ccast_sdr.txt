
ccast SDR format
-----------------

H. Motteler, 2 Sep 2014


The ccast SDR files are saved in HDF 5 format with the Matlab
"-v7.3" option, with HDF groups implementing the Matlab structs.
Matlab users can access these with a simple "load" and HDF users
with standard tools and libs.  See the CrIS User's Guide [1] for
background and details on the geo fields.


Matlab variables
-----------------

  rLW        nchan x 9 x 30 x nscan       LW radiance data
  rMW        nchan x 9 x 30 x nscan       MW radiance data
  rSW        nchan x 9 x 30 x nscan       SW radiance data

  cLW        nchan x 9 x 30 x nscan       LW complex residual
  cMW        nchan x 9 x 30 x nscan       MW complex residual
  cSW        nchan x 9 x 30 x nscan       SW complex residual

  vLW              nchan x 1              LW frequency grid
  vMW              nchan x 1              MW frequency grid
  vSW              nchan x 1              SW frequency grid

  geo              structure              GCRSO geo values
  scTime           34 x nscan             instrument time

  userLW           structure              LW user params
  userMW           structure              MW user params
  userSW           structure              SW user params

  instLW           structure              LW sensor params
  instMW           structure              MW sensor params
  instSW           structure              SW sensor params

  sci              structure array        8-sec sci packets
  eng              structure              4-min eng packet
  rid              string                 date/time string


Field definitions
------------------

rLW, rMW, rSW - nchan x 9 x 30 x nscan arrays of calibrated
radiances.  The second dimension is FOV index, and the third FOR
index.  nchan is the CrIS user grid plus two "guard channels" at 
the edges of each band.  nscan is typically 60 but can be less if
there are gaps in the data.

cLW, cMW, cSW - nchan x 9 x 30 x nscan arrays of complex residuals.
The interpretation may depend on the particular calibration equation
being used.

geo - geolocation data.  See [1] and the geo subsection, below.

L1a_err - 30 x nscan array of L1a processing flags, 1 = bad, 0 = OK.
If all the L1a_err flags from an RDR file are set, L1b processing is
skipped and the L1a processing continues with the next file.

scTime - 34 x nscan array of instrument internal time, currently
around 35 seconds behind real time.  This is IET time but returned
here as milliseconds since 1958.

userLW, userMW, userSW - the user grid parameters, for each band.
The sensor grid is translated to these specs.  The fields are

    v1   - band start
    v2   - band end
    dv   - user dv
    opd  - user opd, 1/(2*dv)

instLW, instMW, instSW - sensor grid parameters.  This is what the
instrument is really using.  The following three values, along with
user.v1 and user.v2, determine the remaining parameters

    wlaser  - metrology laser half-wavelength
    npts    - number of decimated points
    df      - decimation factor

The derived parameters include
  
    dv      - true instrument dv
    opd     - true optical path difference
    freq    - instrument frequency grid

sci - an array of structs with selected values from the 8-second
"science" packets.  Mainly used for ICT modeling.

eng - the most recent 4-minute "engineering" packet.  This includes
instrument parameters and status--in total, more than 3000 values.

rid - a date and time string of the form dYYYYMMDD_tHHMMSSS taken
from the RDR filename and used in the SDR filename.


Geo fields
-----------

The ccast geo fields are as follows.  Field names and data types 
are from the NOAA GCRSO format described in [1].  FORTime is field
of regard (FOR) obs time, IET time in microseconds since 1958.

                  FORTime: [30x60 double]
                   Height: [9x30x60 double]
                 Latitude: [9x30x60 double]
                Longitude: [9x30x60 double]
                  MidTime: [60x1 double]
                 PadByte1: [60x1 double]
           QF1_CRISSDRGEO: [60x1 double]
               SCAttitude: [3x60 double]
               SCPosition: [3x60 double]
               SCVelocity: [3x60 double]
    SatelliteAzimuthAngle: [9x30x60 double]
           SatelliteRange: [9x30x60 double]
     SatelliteZenithAngle: [9x30x60 double]
        SolarAzimuthAngle: [9x30x60 double]
         SolarZenithAngle: [9x30x60 double]
                StartTime: [60x1 double]

The following are selected GCRSO attribute or attribute-derived
fields
            Asc_Desc_Flag: [60x1 double]
             Orbit_Number: [60x1 double]
               Granule_ID: [60x16 char]
         Orbit_Start_Time: [60x1 double]

The following are locally defined

                  sdr_gid: [60x18 char]
                  sdr_ind: [60x1 double]

sdr_gid is a date and time string from the GCRSO file from which we
found this scan, and sdr_ind is the scan index for that file.  These
are mainly intended to make matchups with NOAA IDPS SDR data easy.


Note on radiance data
----------------------

Radiance data is at the user grid dv but includes two "guard
channels" at the start and end of each CrIS band that extend the
user grid.  These are included for compatibility with the NOAA 
SDR format, fast models, and convolution codes, but are not really
valid data because they are outside the passbands used for CrIS
processing.


Note on time fields
--------------------

geo.FORTime is the corrected obs times.  But scTime is better as a
valid data indicator, it is authoritative for that because it is the
sort and merge of all individual obs times that are actually found
in the RDR file, while geo.FORTime is taken from the GCRSO files.

Currently the RDR to SDR time offset is

  dtRDR = 2817 + 4 * 8000;

that is, four scans plus an arbitrary shift of less than a scan.  
To verify this I first look at the phase of the RDR scan times.  
The scans make a distinct pattern--30 obs, slew, space look, slew,
ICT look, slew.  I use this to match times modulo the scan number.
Matching GCRSO/SDR scans with RDR scans is then relatively easy.

On 1 July 2012 the delay increased by 1 second and seems to have 
been stable since then.  The procedure geo_match prints a warning 
if the GCRSO and corrected RDR times differ by more than 1 ms, and 
so did detect the 1 sec shift.


References
-----------

[1] NOAA Technical Report NESDIS 143, Cross Track Infrared Sounder
(CrIS) Sensor Data Record (SDR) Userâ€™s Guide, Version 1.0, Yong Han
et al., Washington DC., Dec 2013.

